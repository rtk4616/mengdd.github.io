
 <!DOCTYPE HTML>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  
    <title>Android Weekly Notes Issue 239 | Meng&#39;s pages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Dandan Meng">
    

    
    <meta name="description" content="Android Weekly Issue #239January 8th, 2017Android Weekly Issue #239本期内容包括: Android Things开发; Android中有用却不常见的一些API介绍(拼写检查, 文字识别, 时间log, 截图, 创建PDF); Gradle依赖管理冲突和解决办法; Looper, Handler和HandlerThread; 兼顾W">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Weekly Notes Issue 239">
<meta property="og:url" content="http://mengdd.github.io/Android-Weekly/2017/01/10/android-weekly-notes-issue-239/index.html">
<meta property="og:site_name" content="Meng's pages">
<meta property="og:description" content="Android Weekly Issue #239January 8th, 2017Android Weekly Issue #239本期内容包括: Android Things开发; Android中有用却不常见的一些API介绍(拼写检查, 文字识别, 时间log, 截图, 创建PDF); Gradle依赖管理冲突和解决办法; Looper, Handler和HandlerThread; 兼顾W">
<meta property="og:image" content="http://mengdd.github.io/images/Android-Looper-Handler.jpeg">
<meta property="og:updated_time" content="2017-01-10T06:29:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Weekly Notes Issue 239">
<meta name="twitter:description" content="Android Weekly Issue #239January 8th, 2017Android Weekly Issue #239本期内容包括: Android Things开发; Android中有用却不常见的一些API介绍(拼写检查, 文字识别, 时间log, 截图, 创建PDF); Gradle依赖管理冲突和解决办法; Looper, Handler和HandlerThread; 兼顾W">
<meta name="twitter:image" content="http://mengdd.github.io/images/Android-Looper-Handler.jpeg">

    
    <link rel="alternative" href="/atom.xml" title="Meng&#39;s pages" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Meng&#39;s pages" title="Meng&#39;s pages"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Meng&#39;s pages">Meng&#39;s pages</a></h1>
				<h2 class="blog-motto">Android developer and maybe other intersting things.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/categories">Categories</a></li>
					
						<li><a href="/tags">Tags</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:mengdd.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/Android-Weekly/2017/01/10/android-weekly-notes-issue-239/" title="Android Weekly Notes Issue 239" itemprop="url">Android Weekly Notes Issue 239</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Dandan Meng" target="_blank" itemprop="author">Dandan Meng</a>
		
  <p class="article-time">
    <time datetime="2017-01-10T06:10:31.000Z" itemprop="datePublished"> Published 2017-01-10</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-Weekly-Issue-239"><span class="toc-number">1.</span> <span class="toc-text">Android Weekly Issue #239</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ARTICLES-amp-TUTORIALS"><span class="toc-number">2.</span> <span class="toc-text">ARTICLES & TUTORIALS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-your-computer-for-Android-dev"><span class="toc-number">2.1.</span> <span class="toc-text">Preparing your computer for Android dev</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Beginner’s-guide-to-Raspberry-Pi-3-B-and-Android-Things"><span class="toc-number">2.2.</span> <span class="toc-text">Beginner’s guide to Raspberry Pi 3 B and Android Things</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-new-project-and-emulator-on-Android-Studio"><span class="toc-number">2.3.</span> <span class="toc-text">Creating new project and emulator on Android Studio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Discovering-Android-API"><span class="toc-number">2.4.</span> <span class="toc-text">Discovering Android API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#No-1-Spell-Checker"><span class="toc-number">2.4.1.</span> <span class="toc-text">No.1 - Spell Checker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-2-Text-Recognizer"><span class="toc-number">2.4.2.</span> <span class="toc-text">No.2 - Text Recognizer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-3-TimingLogger"><span class="toc-number">2.4.3.</span> <span class="toc-text">No.3 - TimingLogger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-4-Taking-screenshots"><span class="toc-number">2.4.4.</span> <span class="toc-text">No.4 - Taking screenshots</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-5-PDF-Creation-API"><span class="toc-number">2.4.5.</span> <span class="toc-text">No.5 - PDF Creation API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Avoiding-Conflicts-in-android-gradle-dependencies"><span class="toc-number">2.5.</span> <span class="toc-text">Avoiding Conflicts in android gradle dependencies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Looper-Handler-and-HandlerThread"><span class="toc-number">2.6.</span> <span class="toc-text">Looper, Handler, and HandlerThread</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java的Thread存在什么问题"><span class="toc-number">2.6.1.</span> <span class="toc-text">Java的Thread存在什么问题?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#我们可以改善这个问题吗"><span class="toc-number">2.6.2.</span> <span class="toc-text">我们可以改善这个问题吗?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android是以什么方式来做这件事的呢"><span class="toc-number">2.6.3.</span> <span class="toc-text">Android是以什么方式来做这件事的呢?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-Wear-packaging"><span class="toc-number">2.7.</span> <span class="toc-text">Android Wear packaging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simple-Things-–-Part-1"><span class="toc-number">2.8.</span> <span class="toc-text">Simple Things – Part 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Options-for-Viewing-PDFs"><span class="toc-number">2.9.</span> <span class="toc-text">Options for Viewing PDFs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clean-tests-Part-1-Naming"><span class="toc-number">2.10.</span> <span class="toc-text">Clean tests, Part 1: Naming</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-I-Don’t-use-Robolectric"><span class="toc-number">2.11.</span> <span class="toc-text">Why I Don’t use Robolectric</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Next-Step-for-Reactive-Android-Programming"><span class="toc-number">2.12.</span> <span class="toc-text">The Next Step for Reactive Android Programming</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DESIGN"><span class="toc-number">3.</span> <span class="toc-text">DESIGN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introducing-Auto-Layout-for-Sketch"><span class="toc-number">3.1.</span> <span class="toc-text">Introducing Auto-Layout for Sketch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Designing-for-Both-Android-and-iOS"><span class="toc-number">3.2.</span> <span class="toc-text">Designing for Both Android and iOS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LIBRARIES-amp-CODE"><span class="toc-number">4.</span> <span class="toc-text">LIBRARIES & CODE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flowless"><span class="toc-number">4.1.</span> <span class="toc-text">flowless</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store"><span class="toc-number">4.2.</span> <span class="toc-text">Store</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="Android-Weekly-Issue-239"><a href="#Android-Weekly-Issue-239" class="headerlink" title="Android Weekly Issue #239"></a>Android Weekly Issue #239</h1><p>January 8th, 2017<br><a href="http://androidweekly.net/issues/issue-239" target="_blank" rel="external">Android Weekly Issue #239</a><br>本期内容包括: Android Things开发; Android中有用却不常见的一些API介绍(拼写检查, 文字识别, 时间log, 截图, 创建PDF); Gradle依赖管理冲突和解决办法; Looper, Handler和HandlerThread; 兼顾Wear1.0和2.0的部署方式; 打开PDF的实现方法; 单元测试的命名; Robolectric的弊病; 迁移到RxJava2的好处和面临的挑战. </p>
<a id="more"></a>
<h1 id="ARTICLES-amp-TUTORIALS"><a href="#ARTICLES-amp-TUTORIALS" class="headerlink" title="ARTICLES &amp; TUTORIALS"></a>ARTICLES &amp; TUTORIALS</h1><h2 id="Preparing-your-computer-for-Android-dev"><a href="#Preparing-your-computer-for-Android-dev" class="headerlink" title="Preparing your computer for Android dev"></a><a href="https://medium.com/@rafael_toledo/preparing-your-android-environment-for-development-android-tutorials-pt-1-5f76ca2b8a32#.yxa0bvkp5" target="_blank" rel="external">Preparing your computer for Android dev</a></h2><p>在Windows, OSX和Linux上设置开发环境.</p>
<h2 id="Beginner’s-guide-to-Raspberry-Pi-3-B-and-Android-Things"><a href="#Beginner’s-guide-to-Raspberry-Pi-3-B-and-Android-Things" class="headerlink" title="Beginner’s guide to Raspberry Pi 3 B and Android Things"></a><a href="http://www.andtuts.com/a-beginners-guide-to-raspberry-pi-3-b-and-android-things/" target="_blank" rel="external">Beginner’s guide to Raspberry Pi 3 B and Android Things</a></h2><p>如何Set up with Android Things.</p>
<h2 id="Creating-new-project-and-emulator-on-Android-Studio"><a href="#Creating-new-project-and-emulator-on-Android-Studio" class="headerlink" title="Creating new project and emulator on Android Studio"></a><a href="https://medium.com/@rafael_toledo/creating-a-new-project-and-an-emulator-on-android-studio-android-tutorials-2-35bd965ac42b#.lwlhy72wf" target="_blank" rel="external">Creating new project and emulator on Android Studio</a></h2><p>如何创建新项目和模拟器.</p>
<h2 id="Discovering-Android-API"><a href="#Discovering-Android-API" class="headerlink" title="Discovering Android API"></a><a href="https://blog.autsoft.hu/discovering-the-android-api-part-1/" target="_blank" rel="external">Discovering Android API</a></h2><p>Android是基于Java的, Java本身已经有四千多个类, Android API也有很多个类, 有一些不太常见但是却很有用的API我们应该了解一下.</p>
<p>这篇文章就旨在发现那些不常见却很有用的API, 并且附有一个<a href="https://github.com/peekler/GDG" target="_blank" rel="external">Demo</a>.</p>
<h3 id="No-1-Spell-Checker"><a href="#No-1-Spell-Checker" class="headerlink" title="No.1 - Spell Checker"></a>No.1 - Spell Checker</h3><p><a href="https://developer.android.com/reference/android/view/textservice/TextServicesManager.html" target="_blank" rel="external">TextServicesManager</a>从API 14开始支持, 可以发现拼写错误, 并返回正确的单词拼写.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextServicesManager tsm = (TextServicesManager) getSystemService(Context.TEXT_SERVICES_MANAGER_SERVICE);  </span><br><span class="line">SpellCheckerSession spellCheckerSession = tsm.newSpellCheckerSession(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">this</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="No-2-Text-Recognizer"><a href="#No-2-Text-Recognizer" class="headerlink" title="No.2 - Text Recognizer"></a>No.2 - Text Recognizer</h3><p>Google Play Services Vision API中的文字识别.</p>
<p>Version API中包括了人脸识别, 二维码扫描和文字识别.</p>
<p>这个例子中可以从图像中扫描出文字信息.</p>
<h3 id="No-3-TimingLogger"><a href="#No-3-TimingLogger" class="headerlink" title="No.3 - TimingLogger"></a>No.3 - TimingLogger</h3><p><a href="https://developer.android.com/reference/android/util/TimingLogger.html" target="_blank" rel="external">TimingLogger</a>是用来测量流逝时间的一个好工具.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TimingLogger timings = <span class="keyword">new</span> TimingLogger(TAG, <span class="string">"methodA"</span>);</span><br><span class="line"><span class="comment">// ... do some work A ...</span></span><br><span class="line">timings.addSplit(<span class="string">"work A"</span>);</span><br><span class="line"><span class="comment">// ... do some work B ...</span></span><br><span class="line">timings.addSplit(<span class="string">"work B"</span>);</span><br><span class="line"><span class="comment">// ... do some work C ...</span></span><br><span class="line">timings.addSplit(<span class="string">"work C"</span>);</span><br><span class="line">timings.dumpToLog();</span><br></pre></td></tr></table></figure></p>
<p>最后一句执行后, 会在log中一次性输出下面的log:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D/TAG     ( 3459): methodA: begin</span><br><span class="line">D/TAG     ( 3459): methodA:      9 ms, work A</span><br><span class="line">D/TAG     ( 3459): methodA:      1 ms, work B</span><br><span class="line">D/TAG     ( 3459): methodA:      6 ms, work C</span><br><span class="line">D/TAG     ( 3459): methodA: end, 16 ms</span><br></pre></td></tr></table></figure></p>
<p>注意需要在adb中使能TAG:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setprop log.tag.TAG_MYJOB VERBOSE</span><br></pre></td></tr></table></figure></p>
<p>假设本例子中TAG = “TAG_MYJOB”.</p>
<h3 id="No-4-Taking-screenshots"><a href="#No-4-Taking-screenshots" class="headerlink" title="No.4 - Taking screenshots"></a>No.4 - Taking screenshots</h3><p>有一些库可以提供截屏, 比如<a href="https://github.com/jraska/Falcon" target="_blank" rel="external">Falcon</a>. </p>
<p>在Android 21之上用<a href="https://developer.android.com/reference/android/media/projection/MediaProjection.html" target="_blank" rel="external">MediaProjection</a>甚至可以录屏.</p>
<p>但是得到屏幕图像更简单的一种方法是:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">View viewRoot = getWindow().getDecorView().getRootView();  </span><br><span class="line">viewRoot.setDrawingCacheEnabled(<span class="keyword">true</span>);  </span><br><span class="line">Bitmap screenShotAsBitmap = Bitmap.createBitmap(viewRoot.getDrawingCache());  </span><br><span class="line">viewRoot.setDrawingCacheEnabled(<span class="keyword">false</span>);  </span><br><span class="line"><span class="comment">// use screenShotAsBitmap as you need</span></span><br></pre></td></tr></table></figure></p>
<h3 id="No-5-PDF-Creation-API"><a href="#No-5-PDF-Creation-API" class="headerlink" title="No.5 - PDF Creation API"></a>No.5 - PDF Creation API</h3><p>从API 19开始Android就提供了API可以创建PDF文档.<br>文中的例子是创建了一个PDF文档, 然后把当前屏幕内容放进去.</p>
<h2 id="Avoiding-Conflicts-in-android-gradle-dependencies"><a href="#Avoiding-Conflicts-in-android-gradle-dependencies" class="headerlink" title="Avoiding Conflicts in android gradle dependencies"></a><a href="https://blog.mindorks.com/avoiding-conflicts-in-android-gradle-dependencies-28e4200ca235#.x66q6p4v4" target="_blank" rel="external">Avoiding Conflicts in android gradle dependencies</a></h2><p>如果两个依赖又都依赖了同一个库, 但是是不同的版本, 那会发生什么呢?</p>
<p>比如下面这个例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">androidTestCompile &apos;junit:junit:4.12&apos; //(Depends on version 1.3)</span><br><span class="line">androidTestCompile &apos;org.mockito:mockito-core:1.10.19&apos; //(Depends on version 1.1)</span><br></pre></td></tr></table></figure></p>
<p>这两个库都依赖于”org.hamcrest:hamcrest-core”, 但是版本却不同.</p>
<p>这种情况下, 最终被包含进build的是最高版本的库.</p>
<p>在依赖被声明的module里运行下面这个命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew dependencies.</span><br></pre></td></tr></table></figure></p>
<p>会显式地看到gradle自动把第二个依赖中的hamcrest库从1.1升级到了1.3.</p>
<p>前面, 两个依赖都是test依赖, 所以gradle自动解决了冲突.  如果两个依赖属于不同的配置, 如, 把第一个<code>androidTestCompile</code>改为<code>compile</code>, gradle将会报错.</p>
<p>原因是:</p>
<blockquote>
<p>When instrumentation tests are run, both the main APK and test APK share the same classpath. Gradle build will fail if the main APK and the test APK use the same library (e.g. Guava) but in different versions. If gradle didn’t catch that, your app could behave differently during tests and during normal run (including crashing in one of the cases).</p>
</blockquote>
<p><strong>解决依赖冲突</strong><br>一旦有了依赖冲突, 就需要开发者决定最后到底用什么版本的库, 有几种解决方法:</p>
<ul>
<li>方法1: 从依赖中排除这个库.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Now junit will not include hamcrest library. Therefore there will be no </span><br><span class="line">//dependency conflict. </span><br><span class="line"> compile (&apos;junit:junit:4.12&apos;)&#123;</span><br><span class="line">    exclude group: &apos;org.hamcrest&apos;, module:&apos;hamcrest-core&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">androidTestCompile (&apos;org.mockito:mockito-core:1.10.19&apos;)&#123;</span><br><span class="line">    exclude group: &apos;org.hamcrest&apos;, module:&apos;hamcrest-core&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>真实的项目中可能有多个依赖依赖于同一个库, 那么我们就需要写多个排除语句.</p>
<ul>
<li>方法2: 显式地声明冲突库的版本.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;junit:junit:4.12&apos; //(Depends on version 1.3)</span><br><span class="line">androidTestCompile &apos;org.mockito:mockito-core:1.10.19&apos; //(Depends on version 1.1)</span><br><span class="line">androidTestCompile &apos;org.hamcrest:hamcrest-core:1.3&apos; //(We explictly mention </span><br><span class="line">//that include version 1.3)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这种方法不用写exclude, 但是当升级直接依赖库的时候需要注意更新这种间接依赖库的版本.</p>
<ul>
<li>方法3: 强制解析.</li>
</ul>
<p>强制设置所有configuration的依赖版本:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    configurations.all &#123;</span><br><span class="line">        resolutionStrategy.force &apos;org.hamcrest:hamcrest-core:1.1&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用这种方法的时候需要小心, 因为与方法2不同, 它是把所有configuration中的版本都强制设置了. 当直接依赖更新的时候, 要注意更新间接依赖的版本.</p>
<h2 id="Looper-Handler-and-HandlerThread"><a href="#Looper-Handler-and-HandlerThread" class="headerlink" title="Looper, Handler, and HandlerThread"></a><a href="https://blog.mindorks.com/android-core-looper-handler-and-handlerthread-bd54d69fe91a#.zf2nhog1x" target="_blank" rel="external">Looper, Handler, and HandlerThread</a></h2><p>这篇文章讨论Looper, Handler和HandlerThread.</p>
<p>首先, 读者应该了解Java的<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html" target="_blank" rel="external">Thread</a>和<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html" target="_blank" rel="external">Runnable</a>.</p>
<p>然后让我们带着问题来探索和复习:</p>
<h3 id="Java的Thread存在什么问题"><a href="#Java的Thread存在什么问题" class="headerlink" title="Java的Thread存在什么问题?"></a>Java的Thread存在什么问题?</h3><p>Java的Thread是一次性的, 当它执行完<code>run()</code>方法之后, 它就死了.</p>
<h3 id="我们可以改善这个问题吗"><a href="#我们可以改善这个问题吗" class="headerlink" title="我们可以改善这个问题吗?"></a>我们可以改善这个问题吗?</h3><p>线程本身是个双刃剑, 我们可以把任务分发到多个线程来加速, 但同时线程过多又会降低速度. 线程创建也会花费时间, 所以最好我们能有一个固定优化数量的线程, 然后用它们来执行任务.</p>
<p><strong>线程复用模型</strong>:</p>
<ul>
<li>1.一个线程保持活跃, 通过它的<code>run()</code>方法不断循环.</li>
<li>2.任务由该线程连续执行, 并保持在一个队列中(MessageQueue).</li>
<li>3.当完成之后结束这个线程.</li>
</ul>
<h3 id="Android是以什么方式来做这件事的呢"><a href="#Android是以什么方式来做这件事的呢" class="headerlink" title="Android是以什么方式来做这件事的呢?"></a>Android是以什么方式来做这件事的呢?</h3><p>Android用<code>Looper</code>, <code>Handler</code>和<code>HandlerThread</code>实现了上述模型.<br>系统可以用这样的图表示:<br><img src="/images/Android-Looper-Handler.jpeg" alt="Android Looper Handler"></p>
<ul>
<li>1.<code>MessageQueue</code>是一个队列, 里面含有需要被处理的任务(消息).</li>
<li>2.<code>Handler</code>利用<code>Looper</code>往队列中加任务, 同时也在任务出队列的时候进行处理.</li>
<li>3.<code>Looper</code>是一个工人, 保持一个线程的活跃, 循环消息队列, 把消息发给对应的handler去处理.(一个线程只能对应一个唯一的<code>Looper</code>, 但是可以有多个关联的<code>Handler</code>).</li>
<li>4.最后<code>Looper.quit()</code>会让线程终止.</li>
</ul>
<p>为一个线程创建<code>Looper</code>和<code>MessageQueue</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LooperThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Handler mHandler; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        Looper.prepare();</span><br><span class="line"></span><br><span class="line">        mHandler = <span class="keyword">new</span> Handler() &#123; </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123; </span><br><span class="line">               <span class="comment">// process incoming messages here</span></span><br><span class="line">               <span class="comment">// this will run in non-ui/background thread</span></span><br><span class="line">            &#125; </span><br><span class="line">        &#125;; </span><br><span class="line"></span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建<code>Handler</code>的时候自动和当前线程的Looper关联, 但是也可以通过构造传入Looper来使Handler关联到特定的线程.</p>
<p>用<code>Handler</code>发消息有两种方式: <code>Message</code>和<code>Runnable</code>.</p>
<p>自己创建一个线程并提供Looper和消息队列的方式是不好的, 所以Android提供了<code>HandlerThread</code>来简化这个过程, 它内部的实现和我们之前做的差不多, 但是是以一种更加稳健的方式. 所以我们应该使用<code>HandlerThread</code>而不是自己实现.</p>
<p>大多数时候你只需要继承<code>HandlerThread</code>来创建它的子类.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandlerThread</span> <span class="keyword">extends</span> <span class="title">HandlerThread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Handler handler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyHandlerThread</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLooperPrepared</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        handler = <span class="keyword">new</span> Handler(getLooper()) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// process incoming messages here</span></span><br><span class="line">                <span class="comment">// this will run in non-ui/background thread</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意:</p>
<ul>
<li><code>Looper</code>只有在<code>HandlerThread</code>的<code>start()</code>方法被调用(线程开始跑)后才会进入prepared状态.</li>
<li>只有在<code>HandlerThread</code>的<code>Looper</code>处于parepared状态以后, <code>Handler</code>才可以关联.</li>
</ul>
<p>另一种创建<code>HandlerThread</code>的方式:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HandlerThread handlerThread = <span class="keyword">new</span> HandlerThread(<span class="string">"MyHandlerThread"</span>);</span><br><span class="line">handlerThread.start();</span><br><span class="line">Handler handler = <span class="keyword">new</span> Handler(handlerThread.getLooper());</span><br></pre></td></tr></table></figure></p>
<p>注意: <code>HandlerThread</code>需要调用<code>quit()</code>方法来停止线程执行和释放资源.</p>
<p>作者文后还附有一个练习的demo.</p>
<h2 id="Android-Wear-packaging"><a href="#Android-Wear-packaging" class="headerlink" title="Android Wear packaging"></a><a href="https://www.novoda.com/blog/android-wear-packaging/" target="_blank" rel="external">Android Wear packaging</a></h2><p>Android Wear 2.0将在2017年发布, 本文讨论了如何同时支持1.0和2.0的应用部署.</p>
<h2 id="Simple-Things-–-Part-1"><a href="#Simple-Things-–-Part-1" class="headerlink" title="Simple Things – Part 1"></a><a href="https://blog.stylingandroid.com/simple-things-part-1/" target="_blank" rel="external">Simple Things – Part 1</a></h2><p>Android Things应用.</p>
<h2 id="Options-for-Viewing-PDFs"><a href="#Options-for-Viewing-PDFs" class="headerlink" title="Options for Viewing PDFs"></a><a href="https://commonsware.com/blog/2017/01/04/options-viewing-pdfs.html" target="_blank" rel="external">Options for Viewing PDFs</a></h2><p>显示PDF传统的方法是通过ACTION_VIEW发出去, 用一个第三方应用打开.</p>
<p>但是有一些开发者不愿意这样做.</p>
<p>还有一种方法是把文件上传, 然后用Google Docs URL用WebView打开它. </p>
<p>除了这些传统的方法, 还有一些选项, 虽然它们各自都有一些问题.</p>
<p>比如用<code>PdfRenderer</code>, 它是Android 5.0加入的.</p>
<p>Mozilka在Firefox上用的是<a href="https://mozilla.github.io/pdf.js/" target="_blank" rel="external">PDF.js</a>, 在Android 4.4+的WebView上可用, 它会给apk带来2MB左右的增加.</p>
<p>Google在Chrominum上用的是<a href="https://pdfium.googlesource.com/pdfium/" target="_blank" rel="external">pdfium</a>, 这是C++. <a href="https://github.com/barteksc/AndroidPdfViewer" target="_blank" rel="external">barteksc/AndroidPdfViewer</a>封装了Pdfium, 处理了渲染和基本的手势, 在一些较老的Android版本上也使用, 但是大约每个CPU架构会给APK增加5MB, 默认情况下你会增加30MB.</p>
<h2 id="Clean-tests-Part-1-Naming"><a href="#Clean-tests-Part-1-Naming" class="headerlink" title="Clean tests, Part 1: Naming"></a><a href="https://android.jlelse.eu/clean-tests-part-1-naming-cce94edf0522#.5nmmqx81y" target="_blank" rel="external">Clean tests, Part 1: Naming</a></h2><p>关于怎么写干净的单元测试, 本文作者提出了几点他对于命名的看法.</p>
<ul>
<li>不要用”test”开头写测试名.</li>
<li>不要把被测试的方法名字写在测试名里.</li>
<li>测试是一种规范.</li>
</ul>
<h2 id="Why-I-Don’t-use-Robolectric"><a href="#Why-I-Don’t-use-Robolectric" class="headerlink" title="Why I Don’t use Robolectric"></a><a href="http://www.philosophicalhacker.com/post/why-i-dont-use-roboletric/" target="_blank" rel="external">Why I Don’t use Robolectric</a></h2><p>作者觉得Robolectric不好的几点:</p>
<ul>
<li>Robolectric mock了一些我们并不拥有的type.</li>
<li>Robolectric turns TDD on its head.</li>
</ul>
<p>所以最好的做法是我们在写Android代码的时候将逻辑代码抽象出来, 与framework分离, 这样在测试的时候不依赖于Android SDK的类, 也不需要robolectric来模拟一个中间层.</p>
<h2 id="The-Next-Step-for-Reactive-Android-Programming"><a href="#The-Next-Step-for-Reactive-Android-Programming" class="headerlink" title="The Next Step for Reactive Android Programming"></a><a href="http://futurice.com/blog/the-next-step-for-reactive-android-programming" target="_blank" rel="external">The Next Step for Reactive Android Programming</a></h2><p>RxJava 2已经推出了, 本篇文章讨论从RxJava 1迁移到RxJava 2会带来的好处和挑战.</p>
<p>好处:</p>
<ul>
<li>兼容了<a href="https://github.com/reactive-streams/reactive-streams-jvm" target="_blank" rel="external">Reactive Streams</a>.</li>
<li>Backpressure的处理.</li>
<li>Performance.</li>
</ul>
<p>挑战:</p>
<ul>
<li>流中不能再使用null.</li>
<li>方法数限制. RxJava 1(5500), RxJava 2(9200).</li>
<li>自定义操作符变得很难写.</li>
</ul>
<p>Note: 可以对比简单的操作符<a href="https://github.com/ReactiveX/RxJava/blob/2.x/src/main/java/io/reactivex/internal/operators/observable/ObservableMap.java" target="_blank" rel="external">map</a>和复杂的操作符<a href="https://github.com/ReactiveX/RxJava/blob/2.x/src/main/java/io/reactivex/internal/operators/observable/ObservableFlatMap.java" target="_blank" rel="external">flatMap</a>.</p>
<h1 id="DESIGN"><a href="#DESIGN" class="headerlink" title="DESIGN"></a>DESIGN</h1><h2 id="Introducing-Auto-Layout-for-Sketch"><a href="#Introducing-Auto-Layout-for-Sketch" class="headerlink" title="Introducing Auto-Layout for Sketch"></a><a href="https://medium.com/sketch-app-sources/introducing-auto-layout-for-sketch-24e7b5d068f9#.tusju2z7k" target="_blank" rel="external">Introducing Auto-Layout for Sketch</a></h2><p>一个Sketch插件, 让你查看不同屏幕上的效果.</p>
<h2 id="Designing-for-Both-Android-and-iOS"><a href="#Designing-for-Both-Android-and-iOS" class="headerlink" title="Designing for Both Android and iOS"></a><a href="https://webdesign.tutsplus.com/articles/a-tale-of-two-platforms-designing-for-both-android-and-ios--cms-23616" target="_blank" rel="external">Designing for Both Android and iOS</a></h2><p>Android和iOS的设计, 很详细的介绍, 最后附有一些resources.</p>
<h1 id="LIBRARIES-amp-CODE"><a href="#LIBRARIES-amp-CODE" class="headerlink" title="LIBRARIES &amp; CODE"></a>LIBRARIES &amp; CODE</h1><h2 id="flowless"><a href="#flowless" class="headerlink" title="flowless"></a><a href="https://github.com/Zhuinden/flowless" target="_blank" rel="external">flowless</a></h2><p>一个框架, 给你Activity的UI状态命名, 管理并记录状态转换.</p>
<h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a><a href="https://github.com/NYTimes/Store" target="_blank" rel="external">Store</a></h2><p>异步数据加载和缓存的库.</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android-Weekly/">Android Weekly</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/Android-Weekly/">Android Weekly</a><a href="/tags/Wear/">Wear</a><a href="/tags/Gradle/">Gradle</a><a href="/tags/RxJava/">RxJava</a><a href="/tags/Test/">Test</a><a href="/tags/RxJava2/">RxJava2</a><a href="/tags/Handler/">Handler</a><a href="/tags/Android-Things/">Android Things</a><a href="/tags/Looper/">Looper</a><a href="/tags/HandlerThread/">HandlerThread</a><a href="/tags/PDF/">PDF</a><a href="/tags/Robolectric/">Robolectric</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://mengdd.github.io/Android-Weekly/2017/01/10/android-weekly-notes-issue-239/" data-title="Android Weekly Notes Issue 239 | Meng&#39;s pages" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/Android/Android-Weekly/2017/01/24/android-weekly-notes-issue-240/" title="Android Weekly Notes Issue 240">
  <strong>上一篇：</strong><br/>
  <span>
  Android Weekly Notes Issue 240</span>
</a>
</div>


<div class="next">
<a href="/Android-Weekly/2017/01/03/android-weekly-notes-issue-238/"  title="Android Weekly Notes Issue 238">
 <strong>下一篇：</strong><br/> 
 <span>Android Weekly Notes Issue 238
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="Android-Weekly/2017/01/10/android-weekly-notes-issue-239/" data-title="Android Weekly Notes Issue 239" data-url="http://mengdd.github.io/Android-Weekly/2017/01/10/android-weekly-notes-issue-239/"></div>
</section>


<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-Weekly-Issue-239"><span class="toc-number">1.</span> <span class="toc-text">Android Weekly Issue #239</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ARTICLES-amp-TUTORIALS"><span class="toc-number">2.</span> <span class="toc-text">ARTICLES & TUTORIALS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-your-computer-for-Android-dev"><span class="toc-number">2.1.</span> <span class="toc-text">Preparing your computer for Android dev</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Beginner’s-guide-to-Raspberry-Pi-3-B-and-Android-Things"><span class="toc-number">2.2.</span> <span class="toc-text">Beginner’s guide to Raspberry Pi 3 B and Android Things</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-new-project-and-emulator-on-Android-Studio"><span class="toc-number">2.3.</span> <span class="toc-text">Creating new project and emulator on Android Studio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Discovering-Android-API"><span class="toc-number">2.4.</span> <span class="toc-text">Discovering Android API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#No-1-Spell-Checker"><span class="toc-number">2.4.1.</span> <span class="toc-text">No.1 - Spell Checker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-2-Text-Recognizer"><span class="toc-number">2.4.2.</span> <span class="toc-text">No.2 - Text Recognizer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-3-TimingLogger"><span class="toc-number">2.4.3.</span> <span class="toc-text">No.3 - TimingLogger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-4-Taking-screenshots"><span class="toc-number">2.4.4.</span> <span class="toc-text">No.4 - Taking screenshots</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-5-PDF-Creation-API"><span class="toc-number">2.4.5.</span> <span class="toc-text">No.5 - PDF Creation API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Avoiding-Conflicts-in-android-gradle-dependencies"><span class="toc-number">2.5.</span> <span class="toc-text">Avoiding Conflicts in android gradle dependencies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Looper-Handler-and-HandlerThread"><span class="toc-number">2.6.</span> <span class="toc-text">Looper, Handler, and HandlerThread</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java的Thread存在什么问题"><span class="toc-number">2.6.1.</span> <span class="toc-text">Java的Thread存在什么问题?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#我们可以改善这个问题吗"><span class="toc-number">2.6.2.</span> <span class="toc-text">我们可以改善这个问题吗?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android是以什么方式来做这件事的呢"><span class="toc-number">2.6.3.</span> <span class="toc-text">Android是以什么方式来做这件事的呢?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-Wear-packaging"><span class="toc-number">2.7.</span> <span class="toc-text">Android Wear packaging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simple-Things-–-Part-1"><span class="toc-number">2.8.</span> <span class="toc-text">Simple Things – Part 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Options-for-Viewing-PDFs"><span class="toc-number">2.9.</span> <span class="toc-text">Options for Viewing PDFs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clean-tests-Part-1-Naming"><span class="toc-number">2.10.</span> <span class="toc-text">Clean tests, Part 1: Naming</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-I-Don’t-use-Robolectric"><span class="toc-number">2.11.</span> <span class="toc-text">Why I Don’t use Robolectric</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Next-Step-for-Reactive-Android-Programming"><span class="toc-number">2.12.</span> <span class="toc-text">The Next Step for Reactive Android Programming</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DESIGN"><span class="toc-number">3.</span> <span class="toc-text">DESIGN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introducing-Auto-Layout-for-Sketch"><span class="toc-number">3.1.</span> <span class="toc-text">Introducing Auto-Layout for Sketch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Designing-for-Both-Android-and-iOS"><span class="toc-number">3.2.</span> <span class="toc-text">Designing for Both Android and iOS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LIBRARIES-amp-CODE"><span class="toc-number">4.</span> <span class="toc-text">LIBRARIES & CODE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flowless"><span class="toc-number">4.1.</span> <span class="toc-text">flowless</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store"><span class="toc-number">4.2.</span> <span class="toc-text">Store</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="mengdd" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>38</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-News/" title="Android News">Android News<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/" title="Android Weekly">Android Weekly<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android-Weekly/" title="Android Weekly">Android Weekly<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Architecture/" title="Architecture">Architecture<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/Design/" title="Design">Design<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/Nougat/Design-Support-Library/" title="Design Support Library">Design Support Library<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Design-Support-Library/" title="Design Support Library">Design Support Library<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Tools/IDE/" title="IDE">IDE<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/React-Native/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/Nougat/" title="Nougat">Nougat<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Nougat/" title="Nougat">Nougat<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Android-Weekly/React-Native/" title="React Native">React Native<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Retrofit/" title="Retrofit">Retrofit<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Retrofit/RxJava/" title="RxJava">RxJava<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/Tools/" title="Tools">Tools<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/others/" title="others">others<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>38</sup></a></li>
			
		
			
				<li><a href="/tags/Android-Weekly/" title="Android Weekly">Android Weekly<sup>25</sup></a></li>
			
		
			
				<li><a href="/tags/RxJava/" title="RxJava">RxJava<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Kotlin/" title="Kotlin">Kotlin<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/MVP/" title="MVP">MVP<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Firebase/" title="Firebase">Firebase<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Dagger2/" title="Dagger2">Dagger2<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/Nougat/" title="Nougat">Nougat<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/ConstraintLayout/" title="ConstraintLayout">ConstraintLayout<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Espresso/" title="Espresso">Espresso<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Fragment/" title="Fragment">Fragment<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Gradle/" title="Gradle">Gradle<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Wear/" title="Wear">Wear<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Android-Studio/" title="Android Studio">Android Studio<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Animation/" title="Animation">Animation<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/MVVM/" title="MVVM">MVVM<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Test/" title="Test">Test<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Retrofit/" title="Retrofit">Retrofit<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android-Things/" title="Android Things">Android Things<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Testing/" title="Testing">Testing<sup>4</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://www.cnblogs.com/mengdd/" target="_blank" title="圣骑士wind">圣骑士wind</a>
            
          </li>
        
          <li>
            
            	<a href="http://talentprince.github.io/" target="_blank" title="长乐未央">长乐未央</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Dandan Meng. <br/>
			This is my blog. Welcome.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/mengdd" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Dandan Meng">Dandan Meng</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"wind"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 


<script type="text/javascript">

var disqus_shortname = 'dandanmeng';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-75132850-1', 'auto');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?83e8338b542a9fd155f68673d113e0ae";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
